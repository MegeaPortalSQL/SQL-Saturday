<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, shrink-to-fit=no, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Cube Documentator</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" crossorigin="anonymous">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Load d3js -->
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <!-- Load listjs to be able to filter lists tables, etc etc-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
    
    <!-- Bootstrap table -->
    <script src="bootstrap-table.js"></script>
    <script src="bootstrap-table-export.js"></script>
    <script src="table-export.js"></script>
    <link rel="stylesheet" href="bootstrap-table.min.css">
    <script src="bootstrap-table-filter.js"></script>
    <script src="bootstrap-table-editable.js"></script>
    <link rel="stylesheet" href="bootstrap-table-fixedcolumn.css">
    <script src="bootstrap-table-fixedcolumn.js"></script>


 
    <style>
        .nav-side-menu {
            overflow: auto;
            font-family: verdana;
            font-size: 12px;
            font-weight: 200;
            background-color: #2e353d;
            position: fixed;
            top: 0px;
            width: 250px;
            height: 100%;
            color: #e1ffff;
        }

            .nav-side-menu .brand {
                background-color: #23282e;
                line-height: 50px;
                display: block;
                text-align: center;
                font-size: 14px;
            }

            .nav-side-menu .toggle-btn {
                display: none;
            }

            .nav-side-menu ul,
            .nav-side-menu li {
                list-style: none;
                padding: 0px;
                margin: 0px;
                line-height: 35px;
                cursor: pointer;
            }

                .nav-side-menu ul :not(collapsed) .arrow:before,
                .nav-side-menu li :not(collapsed) .arrow:before {
                    font-family: FontAwesome;
                    content: "\f078";
                    display: inline-block;
                    padding-left: 10px;
                    padding-right: 10px;
                    vertical-align: middle;
                    float: right;
                }

                .nav-side-menu ul .active,
                .nav-side-menu li .active {
                    border-left: 3px solid #d19b3d;
                    background-color: #4f5b69;
                }

                .nav-side-menu ul .sub-menu li.active,
                .nav-side-menu li .sub-menu li.active {
                    color: #d19b3d;
                }

                    .nav-side-menu ul .sub-menu li.active a,
                    .nav-side-menu li .sub-menu li.active a {
                        color: #d19b3d;
                    }

                .nav-side-menu ul .sub-menu li,
                .nav-side-menu li .sub-menu li {
                    background-color: #181c20;
                    border: none;
                    line-height: 28px;
                    border-bottom: 1px solid #23282e;
                    margin-left: 0px;
                }

                    .nav-side-menu ul .sub-menu li:hover,
                    .nav-side-menu li .sub-menu li:hover {
                        background-color: #020203;
                    }

                    .nav-side-menu ul .sub-menu li:before,
                    .nav-side-menu li .sub-menu li:before {
                        font-family: FontAwesome;
                        content: "\f105";
                        display: inline-block;
                        padding-left: 10px;
                        padding-right: 10px;
                        vertical-align: middle;
                    }

            .nav-side-menu li {
                padding-left: 0px;
                border-left: 3px solid #2e353d;
                border-bottom: 1px solid #23282e;
            }

                .nav-side-menu li a {
                    text-decoration: none;
                    color: #e1ffff;
                }

                    .nav-side-menu li a i {
                        padding-left: 10px;
                        width: 20px;
                        padding-right: 20px;
                    }

                .nav-side-menu li:hover {
                    border-left: 3px solid #d19b3d;
                    background-color: #4f5b69;
                    -webkit-transition: all 1s ease;
                    -moz-transition: all 1s ease;
                    -o-transition: all 1s ease;
                    -ms-transition: all 1s ease;
                    transition: all 1s ease;
                }

        @media (max-width: 767px) {
            .nav-side-menu {
                position: relative;
                width: 100%;
                margin-bottom: 10px;
            }

                .nav-side-menu .toggle-btn {
                    display: block;
                    cursor: pointer;
                    position: absolute;
                    right: 10px;
                    top: 10px;
                    z-index: 10 !important;
                    padding: 3px;
                    background-color: #ffffff;
                    color: #000;
                    width: 40px;
                    text-align: center;
                }

            .brand {
                text-align: left !important;
                font-size: 22px;
                padding-left: 20px;
                line-height: 50px !important;
            }
        }

        @media (min-width: 767px) {
            .nav-side-menu .menu-list .menu-content {
                display: block;
            }

            #main {
                width:  calc(100% - 250px);
                float: right;
                max-width:  calc(100% - 250px);
                overflow: hidden;
                padding-bottom:80px;
            }
        }

        body {
            margin: 0px;
            padding: 0px;
            width: 100%;
            height: 100%;
            position:relative;
        }

        .modal-body {
            max-height: 400px;
            overflow-y: auto;
        }

        pre {
            max-height: 300px;
        }
        /*For cube documentator*/
        .circle {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            font-size: 30px;
            font-weight: bold;
            color: #fff;
            line-height: 70px;
            text-align: center;
            background: #2e353d;
        }
          /* Styles for graphs */
        svg {
            width: 100%;
            height: 100%;
            position: center;
        }

        text{
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .legend {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: 60%;
        }

        rect {
            stroke-width: 2;
        }

        text {
          font: 10px sans-serif;
        }

        .axis text {
          font: 10px sans-serif;
        }

        .axis path{
          fill: none;
          stroke: #000;
        }

        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        .axis .tick line {
          stroke-width: 1;
          stroke: rgba(0, 0, 0, 0.2);
        }

        .axisHorizontal path{
          fill: none;
        }

        .axisHorizontal line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        .axisHorizontal .tick line {
          stroke-width: 1;
          stroke: rgba(0, 0, 0, 0.2);
        }

        .bar {
          fill: steelblue;
          fill-opacity: .9;
        }

        .x.axis path {
          display: none;
        }
        .d3-tip {
          line-height: 1;
          font-weight: bold;
          padding: 12px;
          background: rgba(0, 0, 0, 0.8);
          color: #fff;
          border-radius: 2px;
        }
        /* Creates a small triangle extender for the tooltip */
        .d3-tip:after {
          box-sizing: border-box;
          display: inline;
          font-size: 10px;
          width: 100%;
          line-height: 1;
          color: rgba(0, 0, 0, 0.8);
          content: "\25BC";
          position: absolute;
          text-align: center;
        }
        /* Style northward tooltips differently */
        .d3-tip.n:after {
          margin: -1px 0 0 0;
          top: 100%;
          left: 0;
        }
        /*  Style for dropdowns*/
        .full-width-menu{width:100%; padding-bottom:20px;}
        .dropdown-title{font-weight:bold;}
        /* Style for measures table */
        .measures-table-row{
            padding:30px;
        }
        /* Style form step indicator in measures */
        #breadcrumbs-two{
          overflow: hidden;
          width: 100%;
          margin: 0;
          padding: 0;
          list-style: none;
        }

        #breadcrumbs-two li{
          float: left;
          margin: 0 .5em 0 1em;
        }

        #breadcrumbs-two div{
          padding: .4em 1em;
          float: left;
          text-decoration: none;
          color: #fff;
          position: relative;
        }


        #breadcrumbs-two div::before{
          content: "";
          position: absolute;
          top: 50%; 
          margin-top: -1.5em;   
          border-width: 1.5em 0 1.5em 1em;
          border-style: solid;
          border-color: #ddd #ddd #ddd transparent;
          left: -1em;
        }
        #breadcrumbs-two div::after{
          content: "";
          position: absolute;
          top: 50%; 
          margin-top: -1.5em;   
          border-top: 1.5em solid transparent;
          border-bottom: 1.5em solid transparent;
          border-left: 1em solid #ddd;
          right: -1em;
        }
        #step-catalog{background: #5bc0de ;}
        #breadcrumbs-two #step-catalog::before{
          border-color: #5bc0de #5bc0de #5bc0de transparent;
        }
        #breadcrumbs-two #step-catalog::after{
          border-left: 1em solid #5bc0de;
        }
        #step-cube{background:#d9534f;}
        #breadcrumbs-two #step-cube::before{
          border-color: #d9534f #d9534f #d9534f transparent;
        }
        #breadcrumbs-two #step-cube::after{
          border-left: 1em solid #d9534f;
        }
        #step-measuregroup{background:#5cb85c;}
        #breadcrumbs-two #step-measuregroup::before{
          border-color: #5cb85c #5cb85c #5cb85c transparent;
        }
        #breadcrumbs-two #step-measuregroup::after{
           border-left: 1em solid #5cb85c;
        }
        /* Style for dimensions table */
        #pivottable{
            max-width: 100%;
            overflow-x: scroll;
            max-height: 480px;
            overflow-y: scroll;
        }
        #pivottable td, th {
          white-space: nowrap;
          overflow: hidden;
        }
        .blue-background{
            background:#5bc0de;
            color:#ffffff
        }
        .green-background{
            background:#5cb85c;
            color:#ffffff
        }
       
        button span {
          pointer-events: none;
        }
        /*Adding scroll to dropdowns*/
        .measures-measuregroups-dropdown,.measures-cubes-dropdown, .dimensions-cubes-dropdown {
            overflow:auto;
            max-height:300px;
        }
        
       
    </style>
    
    <script>
        function itemClick(element) {
            //This functions control the main web navigation
            $('.tab').hide();
            $('#tab' + element).show();
            $('.nav-side-menu li').removeClass('active');
            $('#' + element).addClass('active');
            if ($('.toggle-btn').css('display') != 'none') {
                $('.toggle-btn').click()
            }
        }
        function countMeasures(catalog,cube,mg) {
            //Function that updates the circles with the number of cubes, measures shown
            
            //Count Cubes
            var text = $("#measures-cubes > button").text()
            if(text.indexOf("Show all cubes") == -1){
                //If text is not Show all cubes, the user has select one cube
                var numberOfCubes =1;
            }else{
                var numberOfCubes = $("#measures-cubes li").length -1 ;
            }

            //Count Measuregroups
            var text = $("#measures-measuregroups > button").text()
            if(text.indexOf("Show all measuregroups") == -1){
                var numberOfMeasuregroups = 1;
            }else{
                var numberOfMeasuregroups = $("#measures-measuregroups li").length -1 ;
            }
            if(numberOfMeasuregroups==1){
                numberOfCubes=1;
                //Si se ha seleccionado un measuregroup, este pertenece a un cubo concreto
            }

            //Count Measures
            var index;
            var measures=0;
            var direct=0;
            for (index = 0; index < table_measures_data.length; ++index) {
                var row_catalog=table_measures_data[index].catalogescaped;
                var row_cube=table_measures_data[index].cubeescaped;
                var row_mg=table_measures_data[index].measuregroupescaped;
                if( (row_catalog==catalog||catalog=='total') && (row_cube==cube || cube=='total') && (row_mg==mg || mg=='total') ){
                    measures++;
                    if(table_measures_data[index].expression == "Direct measure. No expression"){
                        direct++;
                    }
                }
            }

            $("#measures-counter-cubes").text(numberOfCubes);
            $("#measures-counter-measuregroups").text(numberOfMeasuregroups);
            $("#measures-counter-measures").text(measures);
            $("#measures-counter-directmeasures").text(direct);
            return;
        }
        $(document).ready(function () {
            
            //Hide all tabs and show server view page
            $('.tab').hide();
            $('#tabhome').show();
            //Server view: Hide all counter circles and show the all catalogs one
            $('.server-counter-circles').hide()
            $('#server-counter-total').show();
            //Server view: Hide all graphs and show the all catalogs one
            $('.server-graph').hide()
            $('#graph-total').show();

            //Copy to clipboard function
            var ClipboardHelper = {
                copyElement: function ($element){
                    this.copyText($element.text())
                },
                copyText:function(text) // Linebreaks with \n
                {
                    var $tempInput =  $("<textarea>");
                    $("body").append($tempInput);
                    $tempInput.val(text).select();
                    document.execCommand("copy");
                    $tempInput.remove();
                }
            };
            //Detect click on CopyToClipboard button in measures table
            $("table").on("click",".copytoclipboard",function(){
                var text = $(this).find('pre').text();
                ClipboardHelper.copyText(text);
                alert("Expression copied to your clipboard");
            });

            $(".home-dropdown li a").click(function(){
                var selText = $(this).text();
                $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
                var element = $(this).attr('id');
                //Server view: Hide all counter circles and show the one selected
                $('.server-counter-circles').hide()
                $('#server-counter-'+element).show();
                //Server view: Hide all graphs and show the one selected
                $('.server-graph').hide()
                $('#graph-'+element).show();
            });
            // Measures: Dropdown catalogs
            $(".measures-dropdown li a").click(function(){
                // Change dropdown text
                var selText = $(this).text();
                $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
                //Reset cubes dropdown
                $('.measures-cubes-dropdown li a').parents('.btn-group').find('.dropdown-toggle').html("Show all cubes from selected catalog"+' <span class="caret"></span>');
                //Reset measuregroups dropdown
                $('.measures-measuregroups-dropdown li a').parents('.btn-group').find('.dropdown-toggle').html("Show all measuregroups from selected cube"+' <span class="caret"></span>');
                //Obtain catalog name
                var catalog = ($(this).next().text()).replace(/\s/g, '');; 

                //Filter measures table
                var $table = $('#table-measures');
                if(catalog=='total'){
                    //Showing all the measures
                    $table.bootstrapTable('filterBy', {});
                    console.log("Filtering measures table by nothing ");
                }else{
                    //Shown only measures from selected catalog
                    $table.bootstrapTable('filterBy', {catalogescaped: [catalog]});
                    console.log("Filtering measures table by catalog");
                }

                //Filter cubes list by catalog
                measuresCubesList.filter(function(item) {
                    if (item.values().catalog.replace(/\s/g, '') == catalog || catalog=='total' ||item.values().catalog.replace(/\s/g, '') == "total") {
                        return true;
                    } else {
                        return false;
                    }
                });

                //Filter measuregroups by catalog
                measuresMeasuregroupsList.filter(function(item) {
                    if (item.values().catalog.replace(/\s/g, '') == catalog || catalog=='total' ||item.values().catalog == "total") {
                        return true;
                    } else {
                        return false;
                    }
                });
                //Update counters
                countMeasures(catalog,'total','total');
            });
                // Dimensions: Dropdown catalogs
                $(".dimensions-dropdown li a").click(function(){
                    // Change dropdown text
                    var selText = $(this).text();
                    $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
                    //Reset cubes dropdown
                    $('.dimensions-cubes-dropdown li a').parents('.btn-group').find('.dropdown-toggle').html("Show all cubes from selected catalog"+' <span class="caret"></span>');
                    //Reset measuregroups dropdown
                    $('.dimensions-measuregroups-dropdown li a').parents('.btn-group').find('.dropdown-toggle').html("Show all measuregroups from selected cube"+' <span class="caret"></span>');
                    //Obtain catalog name
                    var catalog = $("#dimensions-catalogs button").text().replace(/\s/g, '');
                    if(catalog.indexOf("Showallcatalogs")!=-1) catalog="total";
                    console.log("Catalog: "+catalog);
                    //Filter cubes by catalog
                    dimensionsCubesList.filter(function(item) {
                        if (item.values().catalog == catalog || catalog=='total' ||item.values().catalog == "total") {
                            return true;
                        } else {
                            return false;
                        }
                    });
                    filterDimensionsTable(dimensions_relationships, catalog,"");

                    //Filter attributes table by catalog
                    attributesTableList.filter(function(item) {
                        if ( (item.values().catalogescaped == catalog || catalog=='total') ) {
                            return true;
                        } else {
                            return false;
                        }
                    });
                });
                // Measures: Dropdown cubes
                $(".measures-cubes-dropdown li a").click(function(){
                    // Change dropdown text
                    var selText = $(this).text();
                    $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
                    //Reset measuregroups dropdown
                    $('.measures-measuregroups-dropdown li a').parents('.btn-group').find('.dropdown-toggle').html("Show all measuregroups from selected cube"+' <span class="caret"></span>');
                    //Obtain catalog and cube name
                    var catalog = $("#measures-catalogs button").text().replace(/\s/g, '');
                    var cube = $("#measures-cubes button").text().replace(/\s/g, '');
                    console.log(catalog);
                    if(cube.indexOf("Showallcubes")!=-1) cube="total";
                    if(catalog.indexOf("Showallcatalogs")!=-1) catalog="total";

                    console.log("Catalog: "+catalog+" Cube: "+cube);

                    //Filter measuregroups by catalog
                    measuresMeasuregroupsList.filter(function(item) {
                        if ( (item.values().catalog.replace(/\s/g, '') == catalog || catalog=='total' || item.values().catalog == "total") && (item.values().cube.replace(/\s/g, '')== cube || cube=='total' || item.values().cube=="total") ) {
                            return true;
                        } else {
                            return false;
                        }
                    });

                    //Filter measures table
                    var $table = $('#table-measures');
                    if(catalog=='total'){
                        if(cube=='total'){
                            //All catalogs, all cubes
                            console.log("Filtering measures table by nothing ");
                                $table.bootstrapTable('filterBy', {});
                        }else{
                            //Al catalogs
                            //Known cube
                            $table.bootstrapTable('filterBy', {cubeescaped:[cube]});
                            console.log("Filtering measures table by cube ");
                        }                       
                    }else{
                        //Known catalog
                        if(cube=='total'){
                            //Al cubes
                            $table.bootstrapTable('filterBy', {catalogescaped:[catalog]});  
                            console.log("Filtering measures table by catalog");
                        }else{
                            $table.bootstrapTable('filterBy', {cubeescaped:[cube], catalogescaped:[catalog]});
                            console.log("Filtering measures table by catalog and cube ");
                        }
                    }
                    //Update counters
                    countMeasures(catalog,cube,'total')
                });
            // Dimensions: Dropdown cubes
                $(".dimensions-cubes-dropdown li a").click(function(){
                    // Change dropdown text
                    var selText = $(this).text();
                    $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
                    //Obtain catalog name
                    var cube = ($(this).next().text()).replace(/\s/g, ''); 
                    var catalog =$("#dimensions-catalogs button").text().replace(/\s/g, '');
                    if(catalog.indexOf("Showallcatalogs")!=-1) catalog="total";
                    console.log("Catalog: "+catalog+" Cube: "+cube);
                    filterDimensionsTable(dimensions_relationships,catalog,cube)
                    
                    //Filter attributes table by catalog and cube 
                    attributesTableList.filter(function(item) {
                        if ( (item.values().catalogescaped == catalog || catalog=='total') && (item.values().cubeescaped == cube.toString() || cube=='total')) {
                            return true;
                        } else {
                            return false;
                        }
                    });
                });
                // Measures: Dropdown measuregroups
                $(".measures-measuregroups-dropdown li a").click(function(){
                    var selText = $(this).text();
                    $(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
                    var measuregroup = $(this).next().text();
                    
                    var catalog =$("#measures-catalogs button").text().replace(/\s/g, '');
                    if(catalog.indexOf("Showallcatalogs")!=-1) catalog="total";
                    
                    var cube =$("#measures-cubes button").text().replace(/\s/g, '');
                    if(cube.indexOf("Showallcubes")!=-1) cube="total";

                    var mg =$("#measures-measuregroups button").text().replace(/\s/g, '');
                    if(mg.indexOf("Showallmeasuregroups")!=-1) mg="total";
                    console.log(mg);

                    //Filtering measures table trying all possible options
                    if(catalog=='total'){
                        if(cube=='total'){
                            if(mg=='total'){
                                //All catalogs, all cubes, all mg
                                $table.bootstrapTable('filterBy', {});
                                console.log("Filtering measures table by nothing");
                            }else{
                                //All catalogs, all cubes
                                //Known measuregroup
                                $table.bootstrapTable('filterBy', {measuregroupescaped:[mg] });
                                console.log("Filtering measures table by mg");
                            }
                        }else{
                            //Al catalogs
                            //Known cube
                            if(mg=='total'){
                                $table.bootstrapTable('filterBy', {cubeescaped:[cube]});
                                console.log("Filtering measures table by cube");
                            }else{
                                $table.bootstrapTable('filterBy', {cubeescaped:[cube], measuregroupescaped:[mg]});
                                console.log("Filtering measures table by cube and mg");
                            }
                        }                       
                    }else{
                        //Known catalog
                        if(cube=='total'){
                            //Al cubes
                            if(mg=='total'){
                                //All mg
                                $table.bootstrapTable('filterBy', {catalogescaped:[catalog]});
                                console.log("Filtering measures table by catalog");
                            }else{
                                //Known mg
                                $table.bootstrapTable('filterBy', { measuregroupescaped:[mg], catalogescaped:[catalog],  catalogescaped:[catalog]});
                                console.log("Filtering measures table by catalog and mg");
                            }
                        }else{
                            //Known cube
                            if(mg=='total'){
                                $table.bootstrapTable('filterBy', {cubeescaped:[cube], catalogescaped:[catalog]});
                                console.log("Filtering measures table by catalog and cube");
                            }else{
                                $table.bootstrapTable('filterBy', { measuregroupescaped:[mg], catalogescaped:[catalog], cubeescaped:[cube]});
                                console.log("Filtering measures table by catalog cube and mg");
                            }
                        }
                    }

                    //Update counters
                    countMeasures(catalog,cube,mg);
                });

                //Update counters at the begining
                countMeasures('total','total','total');

                var dimensions_relationships=[
                    {% for dimension in dimensions %}
                        ["{{dimension.dimension_unique_name}}", "{{dimension.measuregroup_name}}","{{dimension.dimension_granularity}} / {{dimension.measuregroup_cardinality}}","{{dimension.catalog_name  | replace: " ","" | escape}}","{{dimension.cube_name  | replace: " ","" | escape}}"],    
                    {% endfor %}
                ];
                
                var output = getPivotArray(dimensions_relationships, 0, 1, 2);
                $('#pivottable').html(arrayToHTMLTable(output));
  
        }); //Document Ready function
        function getPivotArray(dataArray, rowIndex, colIndex, dataIndex) {
            //Code from http://techbrij.com
            var result = {}, ret = [];
            var newCols = [];
            for (var i = 0; i < dataArray.length; i++) {
 
                if (!result[dataArray[i][rowIndex]]) {
                    result[dataArray[i][rowIndex]] = {};
                }
                result[dataArray[i][rowIndex]][dataArray[i][colIndex]] = dataArray[i][dataIndex];
 
                //To get column names
                if (newCols.indexOf(dataArray[i][colIndex]) == -1) {
                    newCols.push(dataArray[i][colIndex]);
                }
            }
 
            newCols.sort();
            var item = [];
 
            //Add Header Row
            item.push('Measuregroup name');
            item.push.apply(item, newCols);
            ret.push(item);
 
            //Add content 
            for (var key in result) {
                item = [];
                item.push(key);
                for (var i = 0; i < newCols.length; i++) {
                    item.push(result[key][newCols[i]] || "-");
                }
                ret.push(item);
            }
            return ret;
        }
        function arrayToHTMLTable(myArray) {
            var result = "<table class='table  table-striped table-hover table-condensed'>";
            result +=" <thead> <tr>";
            for (var j = 0; j < myArray[0].length; j++) {
                //Measuregroups
                result += "<th class='blue-background'>" + myArray[0][j]+ "</th>";
            }
            result +=" </tr><tr> ";
            result +="<th class='green-background'>Dimension name</th>";
            for (var j = 1; j < myArray[0].length; j++) {
                result +="<th>Granularity / MG Cardinality</th>";
            }
            result +=" </tr></thead> ";
            for (var i = 1; i < myArray.length; i++) {
                //Dimensions
                result += "<tr>";
                result += "<td class='green-background'><strong>" + myArray[i][0] +"</td>";
                for (var j = 1; j < myArray[i].length; j++) {
                    result += "<td>" + myArray[i][j] + "</td>";
                }
                result += "</tr>";
            }
            result += "</table>";
 
            return result;
        }  
        function filterDimensionsTable(array, catalog,cube){
            var new_list = array.slice();
            for (var i = 0; i < array.length; i++) {
                var row_catalog= array[i][3];
                var row_cube= array[i][4];
                if(row_catalog != catalog && catalog!="" && catalog!="total"){
                    var index =  new_list.indexOf(array[i]);
                    new_list.splice(index, 1);
                }else{
                    if(row_cube != cube && cube!="" && cube!="total"){
                        var index =  new_list.indexOf(array[i]);
                        new_list.splice(index, 1);
                    }
                }
                    
            }
            $("#pivottable").html('');
            var output = getPivotArray(new_list, 0, 1, 2);
            $('#pivottable').html(arrayToHTMLTable(output));
            return;
        }
    </script>
</head>
<body>
    <div class="nav-side-menu">
        <div class="brand">Cube documentator</div>
        <i class="fa fa-navicon fa-2x toggle-btn" data-toggle="collapse" data-target="#menu-content"></i>
        <div class="menu-list">
            <ul id="menu-content" class="menu-content collapse out">
                <li id="home"  class="active" onclick="itemClick(this.id)">
                    <a href="#"><i class="fa fa-server fa-lg"></i> Server view </a>
                </li>
                <li id="measures" onclick="itemClick(this.id)">
                    <a href="#"><i class="fa fa-calculator fa-lg"></i> Measures </a>
                </li>
                <li id="dimensions" onclick="itemClick(this.id)">
                    <a href="#"><i class="fa fa-table fa-lg"></i> Dimensions </a>
                </li>

            </ul>
        </div>
    </div>
    <div class="container" id="main">
        <div class="row">
            <div class="col-md-12">
                <div id="page-content-wrapper">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="tab-content">
                                    <div class="tab" id="tabhome">
                                        <div class="row">
                                            <div class="col-lg-8">
                                                <h2>General Server View</h2>
                                                <ul id="breadcrumbs-two">
                                                    <li><div id="step-catalog">Select catalog</div></li>
                                                </ul>
                                            </div>
                                            <div class="col-lg-4">
                                                <img src="http://www.adaptivebi.it/wp-content/themes/big-s/img/logo.png" class="img-responsive" alt="solidQ Logo" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <!-- Single button -->
                                            <div class="btn-group col-xs-12">
                                                <button type="button" class="btn btn-block btn-info  dropdown-toggle dropdown-title" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    Show all catalogs <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu home-dropdown full-width-menu">
                                                    <li ><a href="#" id="total">Show all catalogs</a></li>
                                                    <li role="separator" class="divider"></li>
                                                    {% for catalog in catalogs %}
                                                    <li><a href="#" id="{{catalog | replace: " ","" | escape}}">{{catalog}}</a></li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                        <!-- Counter circles for all catalogs-->
                                        <div id="server-counter-total" class="server-counter-circles">
                                            <hr /><br />
                                            <div class="row">
                                                <div class="col-xs-offset-1 col-xs-2"><div class="center-block circle">{{catalogs | size}}</div></div>
                                                <div class="col-xs-2"><div class="center-block circle">{{totalCounter.measuregroups }}</div></div>
                                                <div class="col-xs-2"><div class="center-block circle">{{totalCounter.totalmeasures }}</div></div>
                                                <div class="col-xs-2"><div class="center-block circle">{{totalCounter.calculatedmeasures}}</div></div>
                                                <div class="col-xs-2"><div class="center-block circle">{{totalCounter.directmeasures}}</div></div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-offset-1 col-xs-2 text-center"><h4>Catalogs</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Measure groups</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Total measures</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Calculated Measures</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Direct measures</h4></div>
                                            </div>
                                            <hr /><br />
                                        </div>

                                        {% for counter in counters %}
                                        <div id="server-counter-{{counter.catalog | replace: " ","" | escape}}" class="server-counter-circles">
                                            <!-- Counter circles for 1 catalog-->
                                            <hr /><br />
                                            <div class="row">
                                                <div class="col-xs-offset-1 col-xs-2"><div class="center-block circle">1</div></div>
                                                <div class="col-xs-2 "><div class="center-block circle">{{counter.measuregroups }}</div></div>
                                                <div class="col-xs-2 "><div class="center-block circle">{{counter.totalmeasures }}</div></div>
                                                <div class="col-xs-2"><div class="center-block circle">{{counter.calculatedmeasures}}</div></div>
                                                <div class="col-xs-2"><div class="center-block circle">{{counter.directmeasures}}</div></div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-offset-1 col-xs-2 text-center"><h4>Catalogs</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Measure groups</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Total measures</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Calculated Measures</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Direct measures</h4></div>
                                            </div>
                                            <hr /><br />
                                        </div>
                                        {% endfor %}
                                        
                                        <div id="graph-total" class="server-graph"></div>
                                        {% for catalog in catalogs %}
                                            <div id="graph-{{catalog | replace: " ","" | escape }}" class="server-graph"></div>
                                        {% endfor %}
                                            <hr /><br />
                                            <p id="date">Documentation created: {{date}}</p>

                                        </div> <!-- tabhome-->
                                    <div id="tabmeasures" class="tab">
                                        <!-- Title and logo-->
                                        <div class="row">
                                            <div class="col-lg-8">
                                                <h2>Databases, Measure groups and Measures</h2>
                                                <ul id="breadcrumbs-two">
                                                    <li ><div id="step-catalog">Select catalog</div></li>
                                                    <li ><div id="step-cube">Select cube</div></li>
                                                    <li><div id="step-measuregroup">Select measuregroup</div></li>
                                                </ul>
                                            </div>
                                            <div class="col-lg-4">
                                                <img src="http://www.adaptivebi.it/wp-content/themes/big-s/img/logo.png" class="img-responsive" alt="solidQ Logo" />
                                            </div>
                                        </div>
                                        <!-- Measures: Dropdowns-->
                                        <div class="row">
                                            <div id="measures-catalogs" class="btn-group col-xs-12">
                                                <button type="button" class="btn btn-block btn-info  dropdown-toggle dropdown-title" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    Show all catalogs <span class="caret"></span>
                                                </button>
                                                <ul class="measures-dropdown dropdown-menu full-width-menu list">
                                                </ul>
                                            </div>
                                            <hr/>
                                            <div id="measures-cubes" class="btn-group col-xs-12"  >
                                                <button type="button" class="btn btn-block btn-danger  dropdown-toggle dropdown-title" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    Show all cubes from selected catalog <span class="caret"></span>
                                                </button>
                                                <ul class="measures-cubes-dropdown dropdown-menu full-width-menu list"></ul>
                                            </div>
                                            <hr/><br/>
                                            <div id="measures-measuregroups" class="btn-group col-xs-12">
                                                <button type="button" class="btn btn-block btn-success  dropdown-toggle dropdown-title" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    Show all measuregroups from selected cube <span class="caret"></span>
                                                </button>
                                                <ul class="measures-measuregroups-dropdown dropdown-menu full-width-menu list"></ul>
                                            </div>
                                            <!-- http://listjs.com/docs/ -->
                                        </div>
                                        <!-- Measures: Information circles-->
                                        <div id="measures-counters" class="measures-counter">
                                            <hr /><br />
                                            <div class="row">
                                                <div class="col-xs-offset-2 col-xs-2"><div class="center-block circle" id="measures-counter-cubes"></div></div>
                                                <div class="col-xs-2"><div class="center-block circle" id="measures-counter-measuregroups"></div></div>
                                                <div class="col-xs-2"><div class="center-block circle" id="measures-counter-measures"></div></div>
                                                <div class="col-xs-2"><div class="center-block circle" id="measures-counter-directmeasures"></div></div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-offset-2 col-xs-2 text-center"><h4>Cubes</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Measure groups</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Total measures</h4></div>
                                                <div class="col-xs-2 text-center"><h4>Direct measures</h4></div>
                                            </div>
                                            <hr />
                                        </div>
                                        <!-- Measures: Table-->
                                        <!--
                                        <div id="measurestable" class="">
                                            <table  id="table_measures" class="table table-striped" data-toggle="table" data-height="300" data-show-columns="true">
                                                <thead>
                                                    <tr>
                                                        <th  style="text-align:center;">Caption</th>
                                                        <th  style="text-align:center;">Name</th>
                                                        <th  style="text-align:center;">Description</th>
                                                        <th  style="text-align:center;">Catalog</th>
                                                        <th  style="text-align:center;">Expression</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="list"></tbody>
                                            </table>
                                        </div>
                                        -->
                                        <h3>Measures Table</h3>
                                        <table id="table-measures"
                                               data-show-columns="true" 
                                               data-pagination="true"
                                               data-classes="table table-no-bordered"
                                               data-sort-name="name"
                                                data-sort-order="asc"
                                               data-striped="true"
                                               data-search="true"
                                               data-show-footer="true"
                                               data-show-export="true"
                                               data-show-pagination-switch="true"
                                               data-filter-control="true"
                                               data-page-list="[5,10, 25, 50, 100]"
                                               data-page-size="5">
                                            <thead>
                                                <tr>
                                                   <!-- <th  data-field="caption" data-sortable="true">Caption</th> -->
                                                    <th data-field="name"  data-filter-control="input" data-sortable="true">Name</th>
                                                    <th data-field="description"  data-filter-control="input"  data-sortable="true">Description</th>
                                                    <th data-field="catalog" data-sortable="true">Catalog</th>
                                                    <th data-field="expression" data-sortable="true" data-formatter="expressionFormatter" >Expression</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                    <!--tab dimensions -->
                                    <div id="tabdimensions" class="tab">
                                        <!-- Dimensions: Title and logo-->
                                        <div class="row">
                                            <div class="col-lg-8">
                                                <h2>Databases, Measure groups and Measures</h2>
                                                <ul id="breadcrumbs-two">
                                                    <li><div id="step-catalog">Select catalog</div></li>
                                                    <li><div id="step-cube">Select cube</div></li>
                                                </ul>
                                            </div>
                                            <div class="col-lg-4">
                                                <img src="http://www.adaptivebi.it/wp-content/themes/big-s/img/logo.png" class="img-responsive" alt="solidQ Logo" />
                                            </div>
                                        </div>
                                        <!-- Dimensions: Dropdowns-->
                                        <div class="row">
                                            <div id="dimensions-catalogs" class="btn-group col-xs-12">
                                                <button type="button" class="btn btn-block btn-info  dropdown-toggle dropdown-title" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    Show all catalogs <span class="caret"></span>
                                                </button>
                                                <ul class="dimensions-dropdown dropdown-menu full-width-menu list"></ul>
                                            </div>
                                            <hr />
                                            <div id="dimensions-cubes" class="btn-group col-xs-12">
                                                <button type="button" class="btn btn-block btn-danger  dropdown-toggle dropdown-title" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    Show all cubes from selected catalog <span class="caret"></span>
                                                </button>
                                                <ul class="dimensions-cubes-dropdown dropdown-menu full-width-menu list"></ul>
                                            </div>
                                            <!-- http://listjs.com/docs/ -->
                                        </div>

                                        <!-- Dimensions: Table of hierarchies-->
                                        <br />
                                        <!-- QUITAR ESTA Y ADD UNA NUEVA CON BOOTSTRAP-TABLES pUEDO PROBAR ESTO
                                               data-fixed-columns="true"
                                               data-fixed-number="1"
                                            PARA TENER FIJA LA PRIMERA COLUMNA-->
                                        <div id="pivottable" class="row measures-table-row"></div>
                                        <!-- Dimensions: Table of attributes-->
                                        <br /><hr/>
                                        <h3>Dimension Attributes</h3>
                                        <!--
                                        <div id="attributestable" class="row measures-table-row fix-width">
                                            <table class="table  table-striped">
                                                <thead>
                                                    <tr>
                                                        <th  class="blue-background" style="text-align:center;">Catalog</th>
                                                        <th  class="blue-background" style="text-align:center;">Cube</th>
                                                        <th  class="blue-background" style="text-align:center;">Dimension</th>
                                                        <th  class="blue-background" style="text-align:center;">Attribute</th>
                                                        <th class="blue-background" style="text-align:center;">Key columns</th>
                                                        <th class="blue-background" style="text-align:center;">Hierarchy</th>
                                                        <th class="blue-background" style="text-align:center;">Description</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="list"></tbody>
                                            </table>
                                        </div>
                                        -->
                                        <table id="table-attributes"
                                               data-show-columns="true"
                                               data-pagination="true"
                                               data-classes="table table-no-bordered"
                                               data-sort-name="name"
                                               data-sort-order="asc"
                                               data-striped="true"
                                               data-search="true"
                                               data-show-footer="true"
                                               data-show-export="true"
                                               data-show-pagination-switch="true"
                                               data-filter-control="true"
                                               data-page-list="[5,10, 25, 50, 100]"
                                               data-page-size="5"
>
                                            <thead>
                                                <tr>
                                                    <th data-field="catalog" data-sortable="true">Catalog</th>
                                                    <th data-field="cube" data-sortable="true">Cube</th>
                                                    <th data-field="dimension"  data-filter-control="select" data-sortable="true">Dimension</th>
                                                    <th data-field="attribute" data-filter-control="input" data-sortable="true">Attribute</th>
                                                    <th data-field="key" data-filter-control="input" data-sortable="true">Key columns</th>
                                                    <th data-field="hierarchy" data-filter-control="input" data-sortable="true">Hierarchy</th>
                                                    <th data-field="description" data-filter-control="input" data-sortable="true">Description</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        /*This script must be always at the end of the body */

        /* Graph for all catalogs*/ 
        var margin = { top: 40, right: 40, bottom: 140, left: 40 },
            width = parseInt(d3.select('#graph-total').style('width'), 10) - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;
        var x0 = d3.scale.ordinal()
            .rangeRoundBands([0, width], .1);
        var x1 = d3.scale.ordinal();
        var y = d3.scale.linear() .range([height, 0]);

        var colorRange = d3.scale.category10(); //Color categories: http://bl.ocks.org/aaizemberg/78bd3dade9593896a59d
        var color = d3.scale.ordinal().range(colorRange.range());
        var xAxis = d3.svg.axis()
            .scale(x0)
            .orient("bottom");
        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .tickFormat(d3.format(".2s"));


        var svg = d3.select("#graph-total").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var tip = d3.tip()
        .attr('class', 'd3-tip')
        .offset([-10, 0])
        .html(function(d) {
            return "<strong>Total measures:</strong> <span style='color:red'>" + d.Total + "</span></br><strong>Calculated measures:</strong> <span style='color:red'>" + d.Calculated + "</span></br><strong>Direct measures:</strong> <span style='color:red'>" + d.Direct + "</span>";
        });
        svg.call(tip);

        // BUSCAR BRUSH d3js barchart
        //Mirar esto: http://stackoverflow.com/questions/21485339/d3-brushing-on-grouped-bar-chart
        //Mirar esto http://bl.ocks.org/nnattawat/9689303
        dataset = [
            {% for group in measuresByGroup %}
                    { label: "{{group.group}}",  "Total": {{group.total}}, "Direct": {{group.direct}},  "Calculated": {{group.calculated}}},
            {% endfor %}
            ];


        var options = d3.keys(dataset[0]).filter(function (key) { return key !== "label"; });

        dataset.forEach(function (d) {
            d.valores = options.map(function (name) { return { name: name, value: +d[name] }; });
        });

        x0.domain(dataset.map(function (d) { return d.label; }));
        x1.domain(options).rangeRoundBands([0, x0.rangeBand()]);
        y.domain([0, d3.max(dataset, function (d) { return d3.max(d.valores, function (d) { return d.value; }); })]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .selectAll("text")
                .attr("y", 15)
                .attr("x", 0)
                .attr("dy", ".35em")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end");

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Number od measures");

        var bar = svg.selectAll(".bar")
            .data(dataset)
            .enter().append("g")
            .attr("class", "rect")
            .attr("transform", function (d) { return "translate(" + x0(d.label) + ",0)"; })
            .on('mouseover', tip.show)
            .on('mouseout', tip.hide);

        bar.selectAll("rect")
            .data(function (d) { return d.valores; })
            .enter().append("rect")
            .attr("width", x1.rangeBand())
            .attr("x", function (d) { return x1(d.name); })
            .attr("y", function (d) { return y(d.value); })
            .attr("value", function (d) { return d.name; })
            .attr("height", function (d) { return height - y(d.value); })
            .style("fill", function (d) { return color(d.name); });


        var legend = svg.selectAll(".legend")
            .data(options.slice())
            .enter().append("g")
            .attr("class", "legend")
            .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

        legend.append("rect")
            .attr("x", width - 18)
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", color);

        legend.append("text")
            .attr("x", width - 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .style("text-anchor", "end")
            .text(function (d) { return d; });


        {% for catalog in catalogs %}
        /* Graph for catalog {{catalog}}*/ 
        var margin = { top: 40, right: 40, bottom: 140, left: 40 },
            width = parseInt(d3.select('#graph-{{catalog | replace: " ","" | escape }}').style('width'), 10) - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;
        var x0 = d3.scale.ordinal()
            .rangeRoundBands([0, width], .1);
        var x1 = d3.scale.ordinal();
        var y = d3.scale.linear() .range([height, 0]);

        var colorRange = d3.scale.category10(); //Color categories: http://bl.ocks.org/aaizemberg/78bd3dade9593896a59d
        var color = d3.scale.ordinal().range(colorRange.range());
        var xAxis = d3.svg.axis()
            .scale(x0)
            .orient("bottom");
        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .tickFormat(d3.format(".2s"));


        var svg = d3.select("#graph-{{catalog | replace: ' ','' | escape }}").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
                return "<strong>Total measures:</strong> <span style='color:red'>" + d.Total + "</span></br><strong>Calculated measures:</strong> <span style='color:red'>" + d.Calculated + "</span></br><strong>Direct measures:</strong> <span style='color:red'>" + d.Direct + "</span>";
             });
            svg.call(tip);
        // BUSCAR BRUSH d3js barchart
        //Mirar esto: http://stackoverflow.com/questions/21485339/d3-brushing-on-grouped-bar-chart
        //Mirar esto http://bl.ocks.org/nnattawat/9689303
        dataset = [
            {% for group in measuresByGroup %}
                {% if group.catalog == catalog %}
                    { label: "{{group.group}}",  "Total": {{group.total}}, "Direct": {{group.direct}},  "Calculated": {{group.calculated}}},
                {% endif %}
            {% endfor %}
            ];


        var options = d3.keys(dataset[0]).filter(function (key) { return key !== "label"; });

        dataset.forEach(function (d) {
            d.valores = options.map(function (name) { return { name: name, value: +d[name] }; });
        });

        x0.domain(dataset.map(function (d) { return d.label; }));
        x1.domain(options).rangeRoundBands([0, x0.rangeBand()]);
        y.domain([0, d3.max(dataset, function (d) { return d3.max(d.valores, function (d) { return d.value; }); })]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .selectAll("text")
                .attr("y", 15)
                .attr("x", 0)
                .attr("dy", ".35em")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end");

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Number od measures");


        var bar = svg.selectAll(".bar")
            .data(dataset)
            .enter().append("g")
            .attr("class", "rect")
            .attr("transform", function (d) { return "translate(" + x0(d.label) + ",0)"; })
           .on('mouseover', tip.show)
            .on('mouseout', tip.hide);

        bar.selectAll("rect")
            .data(function (d) { return d.valores; })
            .enter().append("rect")
            .attr("width", x1.rangeBand())
            .attr("x", function (d) { return x1(d.name); })
            .attr("y", function (d) { return y(d.value); })
            .attr("value", function (d) { return d.name; })
            .attr("height", function (d) { return height - y(d.value); })
            .style("fill", function (d) { return color(d.name); });
            


        var legend = svg.selectAll(".legend")
            .data(options.slice())
            .enter().append("g")
            .attr("class", "legend")
            .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

        legend.append("rect")
            .attr("x", width - 18)
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", color);

        legend.append("text")
            .attr("x", width - 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .style("text-anchor", "end")
            .text(function (d) { return d; });
        {% endfor %}
    </script>
    <script>
        function expressionFormatter(value) {
            // 16777215 == ffffff in decimal
            var color = '#'+Math.floor(Math.random() * 6777215).toString(16);
            returnString ='<pre style="width:30vw" class="expression" >'+value+'</pre> <a  style="width:30vw" type="button" class="copytoclipboard btn btn-info"> <span class="glyphicon glyphicon-copy"></span> Copy to clipboard </a>';
            return returnString;
        }

        /* Lists filters */
        
        /* Measures: Dropdown  Catalogs */
        var options = {
            valueNames: [ 'text', 'id' ],
            item: '<li><a href="#" class="text"></a><p class="id" style="display:none;"></p></li>'
        };

        var values = [
          { text: '<strong>Show all catalogs</strong>', id:'total' }
        {% for catalog in catalogs %}
          , { text: '{{catalog}}', id:'{{catalog | replace: " ","" | escape}}' }
        {% endfor %}
        ];
        var measuresCatalogsList = new List('measures-catalogs', options, values);

        /* Dimensions: Dropdown  Catalogs */
        var options = {
            valueNames: [ 'text', 'id' ],
            item: '<li><a href="#" class="text"></a><p class="id" style="display:none;"></p></li>'
        };

        var values = [
          { text: '<strong>Show all catalogs</strong>', id:'total' }
        {% for catalog in catalogs %}
          , { text: '{{catalog}}', id:'{{catalog | replace: " ","" | escape}}' }
        {% endfor %}
        ];
        var dimensionsCatalogList = new List('dimensions-catalogs', options, values);

        /* Measures: Dropdown Cubes */
        var measuresCubesOptions = {
            valueNames: [ 'text', 'id','catalog' ],
            item: '<li><a href="#" class="text"></a><p class="id" style="display:none;"></p><p class="catalog" style="display:none;"></p></li>'
        };

        var measuresCubesValues = [
          { text: '<strong>Show all cubes from selected catalog</strong>', id:'total', catalog:'total' }
        {% for cube in cubes %}
          , { text: '{{cube.cube_name}}', id:'{{cube.cube_name | replace: " ","" | escape}}',catalog:'{{cube.catalog| replace: " ","" | escape}}' }
        {% endfor %}
        ];
        var measuresCubesList = new List('measures-cubes', measuresCubesOptions, measuresCubesValues);

        /* Dimensions: Dropdown Cubes */
        var dimensionsCubesOptions = {
            valueNames: [ 'text', 'id','catalog' ],
            item: '<li><a href="#" class="text"></a><p class="id" style="display:none;"></p><p class="catalog" style="display:none;"></p></li>'
        };

        var dimensionsCubesValues = [
          { text: '<strong>Show all cubes from selected catalog</strong>', id:'total', catalog:'total' }
        {% for cube in cubes %}
          , { text: '{{cube.cube_name}}', id:'{{cube.cube_name | replace: " ","" | escape}}',catalog:'{{cube.catalog| replace: " ","" | escape}}' }
        {% endfor %}
        ];
        var dimensionsCubesList = new List('dimensions-cubes', dimensionsCubesOptions, dimensionsCubesValues);



        /* Measures: Dropdown Measuregroups */
        var measuresMeasuregroupsOptions = {
            valueNames: [ 'text', 'id','catalog','cube' ],
            item: '<li><a href="#" class="text"></a><p class="id" style="display:none;"></p><p class="catalog" style="display:none;"></p><p class="cube" style="display:none;"></p></li>'
        };

        var measuresMeasuregroupsValues = [
          { text: '<strong>Show all measuregroups from selected cube</strong>', id:'total',catalog:'total',cube:'total' }
        {% for measuregroup in measuregroups %}
          , { text: '{{measuregroup.measuregroup_name}}', id:'{{measuregroup.measuregroup_name| replace: " ","" | escape}}', catalog:'{{measuregroup.catalog_name| replace: " ","" | escape}}', cube:'{{measuregroup.cube_name| replace: " ","" | escape}}' }
        {% endfor %}
        ];
        var measuresMeasuregroupsList = new List('measures-measuregroups', measuresMeasuregroupsOptions, measuresMeasuregroupsValues);

        /* Measures: Table*/
        var $table = $('#table-measures');
        var table_measures_data = [
               {% for measure in calculatedanddirectmeasures %}
                   {% capture expression_size %}{{ measure.expression | size }}{% endcapture %}
        {% if expression_size <1 %} {% assign var='Direct measure. No expression'  %} {% else %} {% assign var={{measure.expression}}  %} {% endif %}

          { caption:'{{measure.measure_caption}}', description:'{{measure.description}}', measuregroup:'{{measure.measuregroup_name}}',measuregroupescaped:'{{measure.measuregroup_name| replace: " ","" | escape}}', name:'{{measure.measure_name}}' , catalogescaped:'{{measure.catalog_name| replace: " ","" | escape}}',catalog:'{{measure.catalog_name}}', expression: '{{var | replace: "'","\""}}', cube:'{{measure.cube_name}}', cubeescaped:'{{measure.cube_name | replace: " ","" | escape}}' } ,      
        {% endfor %}
        ];
        $table.bootstrapTable({data: table_measures_data});  

        /*Dimensions: Attributes Table */
        var $attributes_table = $('#table-attributes');
        var table_attributes_data = [
               {% for  attribute in attributes %}
                    {catalog:'{{attribute.catalog_name}}', cube:'{{attribute.cube_name}}', dimension:'{{attribute.dimension_name}}',attribute:'{{attribute.name}}',catalogescaped:'{{attribute.catalog_name| replace: " ","" | escape}}' , cubeescaped:'{{attribute.cube_name| replace: " ","" | escape}}',description:'{{attribute.description}}', key:'{{attribute.key}}', hierarchy:'{{attribute.hierarchy}}' },
               {% endfor %}
        ];
        $attributes_table.bootstrapTable({data: table_attributes_data});  


        var attributesTableoptions = {
            valueNames: [ 'catalog','cube','dimension','key','attribute','hierarchy','description','catalogescaped','cubeescaped' ],
            item:'<tr style="text-align:center;"><td class="catalog"></td> <td class="cube"></td> <td class="dimension"></td> <td class="attribute"></td>  <td class="key"></td>  <td class="hierarchy"></td>  <td class="description"></td> </tr>'
        };
        var attributesTableValues = [
            {% for attribute in attributes %}
                { catalog:'{{attribute.catalog_name}}', cube:'{{attribute.cube_name}}', dimension:'{{attribute.dimension_name}}',attribute:'{{attribute.name}}',catalogescaped:'{{attribute.catalog_name| replace: " ","" | escape}}' , cubeescaped:'{{attribute.cube_name| replace: " ","" | escape}}',description:'{{attribute.description}}', key:'{{attribute.key}}', hierarchy:'{{attribute.hierarchy}}' },
            {% endfor %}
            ];
        var attributesTableList = new List('attributestable',attributesTableoptions,attributesTableValues);
        /*
        window.copyEvents = {
            'click .copytoclipboard': function (e, value, row, index) {
                alert('You click like action, row: ' + JSON.stringify(row));
                var text = $(this).parents('td').find('pre').text();
                ClipboardHelper.copyText(text);
                alert("Expression copied to your clipboard");
            }
        };
        */
    </script>
</body>
</html>
